{% extends "site/client/base_client.html" %}
{% load static %}
<!--Cette ligne permet l'appel à la méthode json_extra pour foramter les années dans le requete psotgresql-->
{% load json_extra %}

{% block title %}<title>Status de participations annuel</title>{% endblock %}
{% block extra_css %}<link href="{% static 'css/client/caisse/has_annual_particpated.css'%}" rel="stylesheet" type="text/css">{% endblock %}


{% block content %}

<style>
  .pagination{background-color:#0d6efd !important; border: 2px solid #0d6efd !important; /* Force la bordure sur le lien */}
  ul li{margin-bottom:inherit;}
</style>
<div class="pa-container">
  <header class="pa-header">
    <h1 class="pa-title">Participation annuelle de membres</h1>
    <div class="pa-legend">
      <span class="pa-badge pa-badge--ok" title="A participé">✓ Participé</span>
      <span class="pa-badge pa-badge--no" title="Pas de participation">✗ Non Participé</span>
    </div>
  </header>

  <!-- Vue cartes (mobile-first) -->
  <div class="pa-cards">
    {% for m in members %}
      <article class="pa-card" aria-label="Fiche membre">
        <div class="pa-card-head">
          <div class="pa-avatar" aria-hidden="true">{{ m.prenoms|first|default:"?" }}</div>
          <div>
            <div class="pa-card-name">{{ m.prenoms }}</div>
            <div class="pa-card-sub">{{ m.quartier }}</div>
          </div>
        </div>
        <div class="pa-chip-grid">
          {% for y in years %}
            {% if m.statut_par_annee|get_item:y %}
              <span class="pa-chip pa-chip--ok" title="Année {{ y }}: a participé">
                <strong>{{ y }}</strong> ✓
              </span>
            {% else %}
              <span class="pa-chip pa-chip--no" title="Année {{ y }}: pas de participation">
                <strong>{{ y }}</strong> ✗
              </span>
            {% endif %}
          {% endfor %}
        </div>
      </article>
    {% endfor %}
  </div>

  <!-- Vue tableau (affichée à partir de tablette/desktop) -->
  <div class="pa-table-wrap" role="region" aria-label="Tableau des participations" tabindex="0">
    <table class="pa-table">
      <thead>
        <tr>
          <th scope="col">Prénoms</th>
          <th scope="col">Quartier</th>
          {% for y in years %}
            <th scope="col" class="ta-center">{{ y }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for m in members %}
          <tr>
            <td>{{ m.prenoms }}</td>
            <td class="muted">{{ m.quartier }}</td>
            {% for y in years %}
              {% if m.statut_par_annee|get_item:y %}
                <td class="ta-center">
                  <span class="pa-badge pa-badge--ok" title="A participé">✓</span>
                </td>
              {% else %}
                <td class="ta-center">
                  <span class="pa-badge pa-badge--no" title="Pas de participation">✗</span>
                </td>
              {% endif %}
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- PAGINATION -->
  {% if is_paginated %}
          {% if page_obj.has_other_pages %}
              <nav class="mt-4 d-flex justify-content-center">
                  <ul class="pagination shadow-sm rounded-pill overflow-hidden">
                      {% if page_obj.has_previous %}
                          <li class="page-item"><a class="page-link border-0" href="?page={{ page_obj.previous_page_number }}"><i class="fas fa-chevron-left"></i></a></li>
                      {% endif %}

                      <li class="page-item active"><span class="page-link border-0 px-4">Page {{ page_obj.number }} sur {{ page_obj.paginator.num_pages }}</span></li>

                      {% if page_obj.has_next %}
                          <li class="page-item"><a class="page-link border-0" href="?page={{ page_obj.next_page_number }}"><i class="fas fa-chevron-right"></i></a></li>
                      {% endif %}
                  </ul>
              </nav>
      {% endif %}

    {% else %}
        <!-- ETAT VIDE -->
        <div class="coti-empty" role="status">
            <p><i class="fa-regular fa-folder-open fa-3x" aria-hidden="true"></i></p>
            <p>Aucune donnée disponible pour le moment.</p>
        </div>
    {% endif %}

</div>
{% endblock %}